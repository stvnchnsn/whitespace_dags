[2023-06-29T23:50:42.648+0000] {taskinstance.py:1103} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: search_posts.update_db manual__2023-06-29T23:45:43.683527+00:00 [queued]>
[2023-06-29T23:50:42.684+0000] {taskinstance.py:1103} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: search_posts.update_db manual__2023-06-29T23:45:43.683527+00:00 [queued]>
[2023-06-29T23:50:42.686+0000] {taskinstance.py:1308} INFO - Starting attempt 3 of 3
[2023-06-29T23:50:42.738+0000] {taskinstance.py:1327} INFO - Executing <Task(PythonOperator): update_db> on 2023-06-29 23:45:43.683527+00:00
[2023-06-29T23:50:42.751+0000] {standard_task_runner.py:57} INFO - Started process 3312 to run task
[2023-06-29T23:50:42.768+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'search_posts', 'update_db', 'manual__2023-06-29T23:45:43.683527+00:00', '--job-id', '132', '--raw', '--subdir', 'DAGS_FOLDER/search_posts.py', '--cfg-path', '/tmp/tmpril2u1r1']
[2023-06-29T23:50:42.783+0000] {standard_task_runner.py:85} INFO - Job 132: Subtask update_db
[2023-06-29T23:50:42.918+0000] {task_command.py:410} INFO - Running <TaskInstance: search_posts.update_db manual__2023-06-29T23:45:43.683527+00:00 [running]> on host 414be138234a
[2023-06-29T23:50:43.307+0000] {taskinstance.py:1547} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='search_posts' AIRFLOW_CTX_TASK_ID='update_db' AIRFLOW_CTX_EXECUTION_DATE='2023-06-29T23:45:43.683527+00:00' AIRFLOW_CTX_TRY_NUMBER='3' AIRFLOW_CTX_DAG_RUN_ID='manual__2023-06-29T23:45:43.683527+00:00'
[2023-06-29T23:50:43.912+0000] {logging_mixin.py:149} INFO - 
    fresh_data.shape: (4177, 16)
    old_data.shape: (4057, 1)
    update_data.shape: (3170, 16)
    
[2023-06-29T23:50:44.051+0000] {logging_mixin.py:149} INFO -                     created   created_utc  ... search_term                topic
0 2023-06-24 19:20:46-05:00  1.687652e+09  ...     alcohol  alcoholic_beverages
1 2023-06-06 10:58:50-05:00  1.686067e+09  ...     alcohol  alcoholic_beverages
2 2023-05-23 09:16:55-05:00  1.684851e+09  ...     alcohol  alcoholic_beverages
3 2023-06-17 18:15:42-05:00  1.687044e+09  ...     alcohol  alcoholic_beverages
5 2023-06-22 12:26:09-05:00  1.687455e+09  ...     alcohol  alcoholic_beverages

[5 rows x 16 columns]
[2023-06-29T23:50:44.276+0000] {logging_mixin.py:149} INFO - executing BigQuery: 
        INSERT INTO reddit_db.raw_reddit_pulls (created, created_utc, subreddit, subreddit_id, selftext, author_fullname, title, name, id, author, num_comments, url, upvote_ratio, ups, search_term, topic)
        VALUES (Timestamp('2023-06-24 19:20:46-0500', tz='America/Chicago'), 1687652446.0, 'AmItheAsshole', 't5_2xhvq', "One of my (M35) best friends (M34) got married last week.\xa0 He drinks alcohol and our friend group will meet up at breweries a few times a month to hang out.\xa0 His fiance, now wife, does not drink.\xa0 Its never been a part of her life.\xa0\xa0\n\n  \nMy wife and I got a hotel room by the reception space and ubered to the wedding. The ceremony\xa0occurs, we go to whats supposed to be cocktail hour and there was just soda and water.\xa0 No alcohol.\xa0 This was not something we knew about ahead of time.\xa0 There was a palpable buzz among our friend group at the lack of booze.\xa0 A lot of us had spent money on a hotel room and ubering anticipating drinking.\xa0 I'm kind of pissed.\n\n  \n Bride and Groom come to cocktail hour, everyone cheers, and when the bride and groom come mingle with us I ask where is the booze?\xa0 His new wife chimes in saying her family does not drink and they were paying for the wedding, thus no alcohol. I tell them we should know that ahead of time.\xa0 I say i wasted money on a hotel room and ubering.\xa0 I would have just driven if i'd known or maybe not even had come.\xa0 The bride does not take my commentary well and implies I might have a drinking problem (I don't, I only drink with my friends).\xa0 The groom says I don't need to be such an asshole.\xa0 I reiterate that I spent a bunch of money on something I didn't need, we all did.\xa0 The brides pissed at me and asks me to leave.\xa0\xa0\n\n  \nMy wife andI leave, but its clear I touched a nerve.\xa0 In our group chat, friends were mixed on me saying something.\xa0 My wife said I wasn't wrong, but my timing was wrong.\xa0 So was i the asshole?\xa0\xa0", 't2_e43ib5vzf', 'AITA for being pissed there was no Alcohol at a wedding', 't3_14i7ycb', '14i7ycb', 'NoAlcWedding12345', 6385, 'https://www.reddit.com/r/AmItheAsshole/comments/14i7ycb/aita_for_being_pissed_there_was_no_alcohol_at_a/', 0.75, 17443, 'alcohol', 'alcoholic_beverages')
        
[2023-06-29T23:50:46.637+0000] {taskinstance.py:1824} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/operators/python.py", line 181, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/operators/python.py", line 198, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/search_posts.py", line 75, in update_db
    _ = get_big_query(query)
  File "/opt/airflow/dags/lib/big_query_access.py", line 16, in get_big_query
    results = query_job.result()
  File "/home/airflow/.local/lib/python3.7/site-packages/google/cloud/bigquery/job/query.py", line 1520, in result
    do_get_result()
  File "/home/airflow/.local/lib/python3.7/site-packages/google/api_core/retry.py", line 354, in retry_wrapped_func
    on_error=on_error,
  File "/home/airflow/.local/lib/python3.7/site-packages/google/api_core/retry.py", line 191, in retry_target
    return target()
  File "/home/airflow/.local/lib/python3.7/site-packages/google/cloud/bigquery/job/query.py", line 1510, in do_get_result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
  File "/home/airflow/.local/lib/python3.7/site-packages/google/cloud/bigquery/job/base.py", line 911, in result
    return super(_AsyncJob, self).result(timeout=timeout, **kwargs)
  File "/home/airflow/.local/lib/python3.7/site-packages/google/api_core/future/polling.py", line 261, in result
    raise self._exception
google.api_core.exceptions.BadRequest: 400 Column created_utc is not present in table reddit_db.raw_reddit_pulls at [2:58]

Location: US
Job ID: 5f152525-f503-4acb-84f3-9323c08c81a5

[2023-06-29T23:50:46.661+0000] {taskinstance.py:1350} INFO - Marking task as FAILED. dag_id=search_posts, task_id=update_db, execution_date=20230629T234543, start_date=20230629T235042, end_date=20230629T235046
[2023-06-29T23:50:46.687+0000] {standard_task_runner.py:109} ERROR - Failed to execute job 132 for task update_db (400 Column created_utc is not present in table reddit_db.raw_reddit_pulls at [2:58]

Location: US
Job ID: 5f152525-f503-4acb-84f3-9323c08c81a5
; 3312)
[2023-06-29T23:50:46.751+0000] {local_task_job_runner.py:225} INFO - Task exited with return code 1
[2023-06-29T23:50:46.793+0000] {taskinstance.py:2653} INFO - 0 downstream tasks scheduled from follow-on schedule check
